<!-- templates/admin_dashboard.html -->
{% extends 'base.html' %}

{% block title %}Admin Dashboard | Baitech{% endblock %}

{% block content %}
  <h2>üë®‚Äçüíº Admin Dashboard</h2>

  <div class="dashboard-stats">
    <p>Total Users: {{ stats.total_users }}</p>
    <p>Total Service Requests: {{ stats.total_requests }}</p>
    <p>Total Technician Applications: {{ stats.total_applications }}</p>
    <p>Total Orders: {{ stats.total_orders }}</p>
  </div>

  <section class="dashboard-section">
    <h3>üìã Service Requests</h3>
    <table>
      <thead>
        <tr>
          <th>Customer</th>
          <th>Service</th>
          <th>Status</th>
          <th>Technician</th>
          <th>Assign</th>
        </tr>
      </thead>
      <tbody>
        {% for request in service_requests %}
        <tr>
          <td>{{ request.customer_name }}</td>
          <td>{{ request.service_type }}</td>
          <td>{{ request.status }}</td>
          <td>{{ request.assigned_technician or 'Unassigned' }}</td>
          <td>
            <form method="post" action="/services/assign/{{ request._id }}">
              <select name="technician_id">
                {% for tech in technicians %}
                <option value="{{ tech._id }}">{{ tech.name }}</option>
                {% endfor %}
              </select>
              <button type="submit">Assign</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <section class="dashboard-section">
    <h3>‚≠ê Technician Leaderboard</h3>
    <table>
      <thead>
        <tr><th>Name</th><th>Completed Jobs</th><th>Rating</th></tr>
      </thead>
      <tbody>
        {% for tech in leaderboard %}
        <tr>
          <td>{{ tech.name }}</td>
          <td>{{ tech.completed_jobs }}</td>
          <td>{{ '%.1f' % tech.average_rating }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <section class="dashboard-section">
    <h3>üõí Orders</h3>
    <table>
      <thead>
        <tr><th>Customer</th><th>Items</th><th>Total</th><th>Status</th></tr>
      </thead>
      <tbody>
          {% for order in orders %}
          <tr>
            <td>{{ order["customer_name"] }}</td>
            <td>
              <ul>
                {% for item in order["items"] %}
                  <li>{{ item["name"] }} x{{ item["quantity"] }}</li>
                {% endfor %}
              </ul>
            </td>
            <td>Ksh {{ '%.2f' % order["total_price"] }}</td>
            <td>{{ order["order_status"] }}</td>
          </tr>
          {% endfor %}
          
      </tbody>
    </table>
  </section>
{% endblock %}